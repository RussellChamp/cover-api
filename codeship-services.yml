app:
  build:
    image: tester
    context: application
    dockerfile: Dockerfile-dev
  cached: true
  depends_on:
    - testdb
    - minio
  environment:
    ADDR: 0.0.0.0
    HOST: http://riskman.local:3000
    PORT: 3000
    DOCKER_IP: testdb
    GO_ENV: test
    TEST_DATABASE_URL: postgres://riskman:riskman@testdb:5432/riskman_test?sslmode=disable
    API_BASE_URL: http://riskman.local:3000
    APP_NAME: riskman
    SESSION_SECRET: kljsLSDJ83jF^kj3LKNEKn435LDKnt
    AWS_ACCESS_KEY_ID: abc123
    AWS_SECRET_ACCESS_KEY: abcd1234
    AWS_REGION: us-east-1
    AWS_S3_ENDPOINT: http://minio:9000
    AWS_S3_DISABLE_SSL: true
    AWS_S3_BUCKET: riskman-test-bucket
    SAML_SP_ENTITY_ID: http://example.local:3000
    SAML_AUDIENCE_URI: http://example.local:3000
    SAML_IDP_ENTITY_ID: our.idp.net
    SAML_IDP_CERT: -----BEGIN CERTIFICATE-----\nMIIDXTC...2bb\nPw==\n-----END CERTIFICATE-----\n
    SAML_SP_CERT: -----BEGIN CERTIFICATE-----\nMIIDXTC...3cc\nPw==\n-----END CERTIFICATE-----\n
    SAML_SP_PRIVATE_KEY: -----BEGIN PRIVATE KEY-----\nMIIG/gIB...OJxmEMBgT\n-----END PRIVATE KEY-----\n
    SAML_ASSERTION_CONSUMER_SERVICE_URL: http://example.local:3000/auth/callback
    SAML_SSO_URL: https://our.idp.net/saml2/idp/SSOService.php
    SAML_SLO_URL: https://our.idp.net/saml2/idp/SingleLogoutService.php
  working_dir: /riskman
  command: true

testdb:
  image: postgres:11.6
  environment:
    POSTGRES_USER: riskman
    POSTGRES_PASSWORD: riskman
    POSTGRES_DB: riskman_test

binary:
  build:
    image: 369020531563.dkr.ecr.us-east-1.amazonaws.com/cover-stg
    context: application
    dockerfile: Dockerfile
  cached: true
  working_dir: /riskman
  command: true

docs:
  build:
    image: apidocs
    context: application
    dockerfile: Dockerfile-api-docs
  cached: true
  encrypted_env_file: .env.encrypted

ecsdeploy:
  image: silintl/ecs-deploy:latest
  encrypted_env_file: .env.encrypted

awsgenerator:
  image: codeship/aws-ecr-dockercfg-generator
  encrypted_env_file: .env.encrypted
  add_docker: true

tracker:
  image: silintl/app-deployment-tracker-ga:latest
  environment:
    TRACKING_ID: UA-56269387-10

rollbar:
  image: silintl/notify-rollbar-deployment:latest
  encrypted_env_file: .env.encrypted

minio:
  image: minio/minio
  command: server /data
  environment:
    MINIO_ROOT_USER: abc123
    MINIO_ROOT_PASSWORD: abcd1234

